



<!DOCTYPE html>



<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Wafer Scale Mapping (Marocco) &mdash; HBP Neuromorphic Computing Platform Guidebook (WIP)</title>
    
    <link rel="stylesheet" href="../_static/hbpdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/extra.js"></script>
    <script type="text/javascript" src="../_static/hbpdoc.js"></script>
    <link rel="top" title="HBP Neuromorphic Computing Platform Guidebook (WIP)" href="../index.html" />
    <link rel="up" title="The BrainScaleS “physical model” system" href="pm.html" />
    <link rel="next" title="Executable System Specification (ESS)" href="ess.html" />
    <link rel="prev" title="Hardware configuration" href="pm_hardware_configuration.html" />
<meta name="viewport" content="width=device-width, initial-scale=1">

  </head>
  <body>
<div class="hbpdoc-page">
    <section class="hbpdoc-title page-header">
        <a class="project-title" href="../index.html">HBP Neuromorphic Computing Platform Guidebook</a>

        <a class="hbpdoc-toc-toggle pull-right" href>
            <span class="zmdi zmdi-menu"></span> <span class="sr-only icon-text">Menu</span>
        </a>
    </section>
    <section class="hbpdoc-main">
        <nav class="hbpdoc-sidebar hbpdoc-container">
            <a class="hbpdoc-toc-toggle pull-right" href>
                <span class="zmdi zmdi-menu"></span> <span class="sr-only icon-text">Menu</span>
            </a>
            
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/HBP_Primary_RGB_logoOnlyScaled68px.png" alt="Logo"/>
            </a></p>
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Wafer Scale Mapping (Marocco)</a><ul>
<li><a class="reference internal" href="#installation">Installation</a><ul>
<li><a class="reference internal" href="#ssh-agent">ssh-agent</a></li>
<li><a class="reference internal" href="#waf">waf</a></li>
<li><a class="reference internal" href="#pyhmf-marocco-and-dependencies">pyhmf, marocco and dependencies</a></li>
<li><a class="reference internal" href="#paths">paths</a></li>
</ul>
</li>
<li><a class="reference internal" href="#usage">Usage</a><ul>
<li><a class="reference internal" href="#calibration">Calibration</a></li>
<li><a class="reference internal" href="#running-pynn-scripts">Running pyNN scripts</a></li>
<li><a class="reference internal" href="#inspect-the-configuration">Inspect the Configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#inspect-the-synapse-loss">Inspect the synapse loss</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="pm_hardware_configuration.html"
                        title="previous chapter">Hardware configuration</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="ess.html"
                        title="next chapter">Executable System Specification (ESS)</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/pm/using_pm_newflow.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
        </nav>

        <article class="hbpdoc-content">

            <div class="content">
                
                <div class="breadcrumb breadcrumb-meta expand">
                    
                    <a href="pm.html">The BrainScaleS &#8220;physical model&#8221; system</a>
                    
                </div>
                

                <aside class="hbpdoc-hnav hbpdoc-hnav-top">
                    
                    <span class="hbpdoc-hnav-previous">
                        previous: <a class="hbpdoc-hnav-link" href="pm_hardware_configuration.html">Hardware configuration</a>
                    </span>
                    
                    
                    <span class="hbpdoc-hnav-next">
                        next: <a class="hbpdoc-hnav-link" href="ess.html">Executable System Specification (ESS)</a>
                    </span>
                    
                </aside>

                <div class="section" id="wafer-scale-mapping-marocco">
<h1>Wafer Scale Mapping (Marocco)<a class="headerlink" href="#wafer-scale-mapping-marocco" title="Permalink to this headline">¶</a></h1>
<p>Wafer Scale Mapping is performed by <tt class="docutils literal"><span class="pre">marocco</span></tt> and described in the <a class="reference external" href="http://www.kip.uni-heidelberg.de/Veroeffentlichungen/details.php?id=3052">PhD thesis of S. Jeltsch</a>.</p>
<p>Code documentation is provided by <tt class="docutils literal"><span class="pre">doxygen</span></tt> and available as <a class="reference external" href="https://brainscales-r.kip.uni-heidelberg.de:8443/view/doc/job/doc-dsl_marocco/marocco_Documentation">documentation-marocco</a>.</p>
<p>In the following the build and work flow on UHEI BrainScaleS cluster
frontend nodes is described. If the BrainScaleS is accessed through the
Collaboratory or the Python client, the installation can be skipped.</p>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>Create and change to a directory for your projects, preferably on <tt class="docutils literal"><span class="pre">wang</span></tt>, e.g.: <tt class="docutils literal"><span class="pre">/wang/users/&lt;somebody&gt;/cluster_home/projects</span></tt>.</p>
<div class="section" id="ssh-agent">
<h3>ssh-agent<a class="headerlink" href="#ssh-agent" title="Permalink to this headline">¶</a></h3>
<p>To reduce the amount of typing, please consider using <tt class="docutils literal"><span class="pre">ssh-agent</span></tt> to cache your key password:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nb">eval</span> <span class="sb">`</span>ssh-agent<span class="sb">`</span>
ssh-add ~/path/to/your/private_id_rsa
</pre></div>
</div>
</div>
<div class="section" id="waf">
<h3>waf<a class="headerlink" href="#waf" title="Permalink to this headline">¶</a></h3>
<p>This step is optional as the default environment already provides a <tt class="docutils literal"><span class="pre">waf</span></tt> executable.
However, if you need a customized waf version:</p>
<div class="highlight-bash"><div class="highlight"><pre>git clone git@gitviz.kip.uni-heidelberg.de:waf.git -b symwaf2ic visions-waf
make -f visions-waf/Makefile
ln -f visions-waf/waf .
<span class="nb">alias </span><span class="nv">waf</span><span class="o">=</span><span class="nv">$PWD</span>/waf
</pre></div>
</div>
</div>
<div class="section" id="pyhmf-marocco-and-dependencies">
<h3>pyhmf, marocco and dependencies<a class="headerlink" href="#pyhmf-marocco-and-dependencies" title="Permalink to this headline">¶</a></h3>
<p>Then create and change to a directory for marocco, e.g., <tt class="docutils literal"><span class="pre">/wang/users/somebody/cluster_home/projects/marocco</span></tt>:</p>
<div class="highlight-bash"><div class="highlight"><pre>waf setup --project pyhmf --project<span class="o">=</span>marocco --without-ester
waf configure
waf install --test-execnone
<span class="c"># some extra targets are needed</span>
waf install --target<span class="o">=</span>pymarocco,pyhalbe,pysthal,redman_xml --test-execnone
</pre></div>
</div>
<p>including cake (optional):</p>
<div class="highlight-bash"><div class="highlight"><pre>waf setup --project pyhmf --project marocco --project cake --without-ester
waf configure
waf install --test-execnone
<span class="c"># some extra targets are needed</span>
waf install --target<span class="o">=</span>pymarocco,pyhalbe,pysthal,redman_xml,pycake --test-execnone
</pre></div>
</div>
<p>including support for ESS add <tt class="docutils literal"><span class="pre">--with-ess</span></tt> to setup call.</p>
</div>
<div class="section" id="paths">
<h3>paths<a class="headerlink" href="#paths" title="Permalink to this headline">¶</a></h3>
<p>To include the local paths in your environment, please use:</p>
<div class="highlight-bash"><div class="highlight"><pre>module load localdir
module load pynn/0.7.5
module load mongo
module load yaml-cpp/0.5.2
</pre></div>
</div>
<p>Another method would be to create an init file and put all the needed parts into a script:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nb">echo</span> <span class="s2">&quot;INSTALLED_LIB_PATH=$(readlink -e lib)&quot;</span> &gt; init.sh
cat &gt;&gt;init.sh<span class="s">&lt;&lt;EOF</span>
<span class="s">export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:\${INSTALLED_LIB_PATH}</span>
<span class="s">export PYTHONPATH=$PYTHONPATH:\${INSTALLED_LIB_PATH}</span>
<span class="s">module load pynn/0.7.5</span>
<span class="s">module load mongo</span>
<span class="s">module load yaml-cpp/0.5.2</span>
<span class="s">EOF</span>
</pre></div>
</div>
<p>In every (!) fresh shell you now have to source the <tt class="docutils literal"><span class="pre">init.sh</span></tt>:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nb">source </span>path/to/init.sh
</pre></div>
</div>
<p>Check if the installation and the setup of variables is fine:</p>
<div class="highlight-bash"><div class="highlight"><pre>python -c <span class="s2">&quot;import pyhmf&quot;</span> <span class="o">&amp;&amp;</span> <span class="nb">echo </span>ok
</pre></div>
</div>
<p>should print <tt class="docutils literal"><span class="pre">ok</span></tt>, if instead:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s">&quot;&lt;string&gt;&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">ImportError</span><span class="p">:</span> <span class="n">No</span> <span class="n">module</span> <span class="n">named</span> <span class="n">pyhmf</span>
</pre></div>
</div>
<p>occurs, either the installation failed or the environment variables responsible for finding the module are wrong. In that case, double check if you followed the instructions 1:1.</p>
</div>
</div>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p><tt class="docutils literal"><span class="pre">pyhmf</span></tt> is the C++ implementation of <tt class="docutils literal"><span class="pre">pynn</span></tt> for the NMPM1. To
allow you to change the simulation/emulation backend easily, it is
adviced to give the <tt class="docutils literal"><span class="pre">pyhmf</span></tt> module an other name like <tt class="docutils literal"><span class="pre">pynn</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">pyhmf</span> <span class="kn">as</span> <span class="nn">pynn</span>
</pre></div>
</div>
<p>We also need the helper module <tt class="docutils literal"><span class="pre">pymarocco</span></tt> that takes care of
hardware and marocco specific settings:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">pyhmf</span> <span class="kn">as</span> <span class="nn">pynn</span>
<span class="kn">from</span> <span class="nn">pymarocco</span> <span class="kn">import</span> <span class="n">PyMarocco</span>

<span class="n">marocco</span> <span class="o">=</span> <span class="n">PyMarocco</span><span class="p">()</span>
<span class="n">pynn</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">marocco</span> <span class="o">=</span> <span class="n">marocco</span><span class="p">)</span>
</pre></div>
</div>
<p>Make sure that the call to <tt class="docutils literal"><span class="pre">pynn.setup</span></tt> happens before creating
populations, if not, the populations will not be visible to <tt class="docutils literal"><span class="pre">marocco</span></tt>.</p>
<p>Now it is time to start marocco. When invoking <tt class="docutils literal"><span class="pre">python</span></tt>, an MPI
library has to be preloaded.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">LD_PRELOAD</span><span class="o">=</span>/usr/lib/openmpi/lib/libmpi.so python main.py
</pre></div>
</div>
<p>If you don&#8217;t preload libmpi, the error message is:</p>
<div class="highlight-bash"><div class="highlight"><pre>python: symbol lookup error: /usr/lib/openmpi/lib/openmpi/mca_paffinity_linux.so:
        undefined symbol: mca_base_param_reg_int
</pre></div>
</div>
<p>If pyNN.recording.files cannot be imported, pyNN is missing from your paths:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s">&quot;main.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">5</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
        <span class="kn">import</span> <span class="nn">pyhmf</span> <span class="kn">as</span> <span class="nn">pynn</span>
<span class="ne">ImportError</span><span class="p">:</span> <span class="n">No</span> <span class="n">module</span> <span class="n">named</span> <span class="n">pyNN</span><span class="o">.</span><span class="n">recording</span><span class="o">.</span><span class="n">files</span>
</pre></div>
</div>
<p>You can add pyNN to your paths by loading the module:</p>
<div class="highlight-bash"><div class="highlight"><pre>module load pynn/0.7.5
</pre></div>
</div>
<p>In the following example, one neuron is placed on the wafer, however,
by choosing the backend None, the actual hardware is not used.</p>
<p>Available backends: None, Hardware, ESS. None does only mapping and
routing (a dry run). Hardware runs on the real neuromorphic
hardware. ESS runs a simulation of the hardware: the Executable System
Specification.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">pyhmf</span> <span class="kn">as</span> <span class="nn">pynn</span>
<span class="kn">from</span> <span class="nn">pymarocco</span> <span class="kn">import</span> <span class="n">PyMarocco</span>

<span class="n">marocco</span> <span class="o">=</span> <span class="n">PyMarocco</span><span class="p">()</span>
<span class="n">marocco</span><span class="o">.</span><span class="n">backend</span> <span class="o">=</span> <span class="n">PyMarocco</span><span class="o">.</span><span class="n">None</span>

<span class="n">pynn</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">marocco</span> <span class="o">=</span> <span class="n">marocco</span><span class="p">)</span>

<span class="n">neuron</span> <span class="o">=</span> <span class="n">pynn</span><span class="o">.</span><span class="n">Population</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">pynn</span><span class="o">.</span><span class="n">IF_cond_exp</span><span class="p">)</span>

<span class="n">pynn</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">pynn</span><span class="o">.</span><span class="n">end</span><span class="p">()</span>
</pre></div>
</div>
<p>In the output you should see:</p>
<div class="highlight-bash"><div class="highlight"><pre>Populations:
0th element:    0x1f98650       Population<span class="o">(</span>IF_cond_exp, 1<span class="o">)</span>
</pre></div>
</div>
<p>If you don&#8217;t see this output, make sure that you called
<tt class="docutils literal"><span class="pre">pynn.setup(marocco</span> <span class="pre">=</span> <span class="pre">marocco)</span></tt> before the call to
<tt class="docutils literal"><span class="pre">pynn.Population</span></tt>.</p>
<p>You will also see a lot of debug output. To set the log level, add</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">pylogging</span>
<span class="k">for</span> <span class="n">domain</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;&quot;</span><span class="p">]:</span>
     <span class="n">pylogging</span><span class="o">.</span><span class="n">set_loglevel</span><span class="p">(</span><span class="n">pylogging</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">domain</span><span class="p">),</span> <span class="n">pylogging</span><span class="o">.</span><span class="n">LogLevel</span><span class="o">.</span><span class="n">ERROR</span><span class="p">)</span>
</pre></div>
</div>
<p>after the line importing <tt class="docutils literal"><span class="pre">PyMarocco</span></tt> to your script.</p>
<p>As we did not specify on which chip the neuron should be placed,
marocco decides automatically to use <tt class="docutils literal"><span class="pre">HICANNOnWafer(X(18),</span> <span class="pre">Y(7)),</span>
<span class="pre">Wafer(0)</span></tt> which is in the center of the wafer.</p>
<p>To choose the HICANN a population is placed on, we give marocco a hint:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">Coordinate</span> <span class="kn">as</span> <span class="nn">C</span>

<span class="n">marocco</span><span class="o">.</span><span class="n">manual_placement</span><span class="o">.</span><span class="n">on_hicann</span><span class="p">(</span><span class="n">neuron</span><span class="p">,</span> <span class="n">C</span><span class="o">.</span><span class="n">HICANNOnWafer</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">C</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="mi">5</span><span class="p">)))</span>
</pre></div>
</div>
<p>At the end, the script is the following:</p>
<p>nmpm1_marocco_intro.py:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">pyhmf</span> <span class="kn">as</span> <span class="nn">pynn</span>
<span class="kn">import</span> <span class="nn">Coordinate</span> <span class="kn">as</span> <span class="nn">C</span>
<span class="kn">from</span> <span class="nn">pymarocco</span> <span class="kn">import</span> <span class="n">PyMarocco</span>
<span class="kn">from</span> <span class="nn">pymarocco.results</span> <span class="kn">import</span> <span class="n">Marocco</span>

<span class="kn">import</span> <span class="nn">pylogging</span>
<span class="k">for</span> <span class="n">domain</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;Calibtic&quot;</span><span class="p">,</span> <span class="s">&quot;marocco&quot;</span><span class="p">]:</span>
    <span class="n">pylogging</span><span class="o">.</span><span class="n">set_loglevel</span><span class="p">(</span><span class="n">pylogging</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">domain</span><span class="p">),</span> <span class="n">pylogging</span><span class="o">.</span><span class="n">LogLevel</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>

<span class="n">marocco</span> <span class="o">=</span> <span class="n">PyMarocco</span><span class="p">()</span>
<span class="n">marocco</span><span class="o">.</span><span class="n">persist</span> <span class="o">=</span> <span class="s">&quot;results.bin&quot;</span>
<span class="n">pynn</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">marocco</span> <span class="o">=</span> <span class="n">marocco</span><span class="p">)</span>

<span class="n">pop</span> <span class="o">=</span> <span class="n">pynn</span><span class="o">.</span><span class="n">Population</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">pynn</span><span class="o">.</span><span class="n">IF_cond_exp</span><span class="p">)</span>

<span class="n">marocco</span><span class="o">.</span><span class="n">manual_placement</span><span class="o">.</span><span class="n">on_hicann</span><span class="p">(</span><span class="n">pop</span><span class="p">,</span> <span class="n">C</span><span class="o">.</span><span class="n">HICANNOnWafer</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">C</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="mi">5</span><span class="p">)),</span> <span class="mi">4</span><span class="p">)</span>

<span class="n">pynn</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">pynn</span><span class="o">.</span><span class="n">end</span><span class="p">()</span>

<span class="n">results</span> <span class="o">=</span> <span class="n">Marocco</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">marocco</span><span class="o">.</span><span class="n">persist</span><span class="p">)</span>

<span class="k">for</span> <span class="n">neuron</span> <span class="ow">in</span> <span class="n">pop</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">placement</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">neuron</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">denmem</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">logical_neuron</span><span class="p">():</span>
            <span class="k">print</span> <span class="n">denmem</span>
</pre></div>
</div>
<p>We also added a print out of the chosen neuron circuits:</p>
<div class="highlight-bash"><div class="highlight"><pre>NeuronOnWafer<span class="o">(</span>NeuronOnHICANN<span class="o">(</span>X<span class="o">(</span>0<span class="o">)</span>, top<span class="o">)</span>, HICANNOnWafer<span class="o">(</span>X<span class="o">(</span>5<span class="o">)</span>, Y<span class="o">(</span>5<span class="o">)))</span>
NeuronOnWafer<span class="o">(</span>NeuronOnHICANN<span class="o">(</span>X<span class="o">(</span>1<span class="o">)</span>, top<span class="o">)</span>, HICANNOnWafer<span class="o">(</span>X<span class="o">(</span>5<span class="o">)</span>, Y<span class="o">(</span>5<span class="o">)))</span>
NeuronOnWafer<span class="o">(</span>NeuronOnHICANN<span class="o">(</span>X<span class="o">(</span>0<span class="o">)</span>, bottom<span class="o">)</span>, HICANNOnWafer<span class="o">(</span>X<span class="o">(</span>5<span class="o">)</span>, Y<span class="o">(</span>5<span class="o">)))</span>
NeuronOnWafer<span class="o">(</span>NeuronOnHICANN<span class="o">(</span>X<span class="o">(</span>1<span class="o">)</span>, bottom<span class="o">)</span>, HICANNOnWafer<span class="o">(</span>X<span class="o">(</span>5<span class="o">)</span>, Y<span class="o">(</span>5<span class="o">)))</span>
</pre></div>
</div>
<div class="section" id="calibration">
<h3>Calibration<a class="headerlink" href="#calibration" title="Permalink to this headline">¶</a></h3>
<p>To change the calibration backend from database to XML set
&#8220;calib_backend&#8221; to XML. Then the calibration is looked up in xml files
named <tt class="docutils literal"><span class="pre">w0-h84.xml</span></tt>, <tt class="docutils literal"><span class="pre">w0-h276.xml</span></tt>, etc. in the directory
&#8220;calib_path&#8221;.</p>
</div>
<div class="section" id="running-pynn-scripts">
<span id="label-marocco-example"></span><h3>Running pyNN scripts<a class="headerlink" href="#running-pynn-scripts" title="Permalink to this headline">¶</a></h3>
<p>To run on the <em>hardware</em> one needs to use the slurm job queue system:</p>
<div class="highlight-bash"><div class="highlight"><pre>srun -p wafer python nmpm1_single_neuron.py
</pre></div>
</div>
<p>nmpm1_single_neuron.py:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># -*- coding: utf-8 -*-</span>
<span class="c">#</span>
<span class="c"># Minimal Working Example of a single neuron and a single spike source on NMPM1</span>
<span class="c">#</span>
<span class="c"># Andreas Stöckel, October 2015</span>
<span class="c">#</span>
<span class="c"># Modified by S. Schmitt, October 2015</span>
<span class="c"># Modified by S. Schmitt, July 2016</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pylogging</span>
<span class="kn">import</span> <span class="nn">pyhmf</span> <span class="kn">as</span> <span class="nn">pynn</span>
<span class="kn">from</span> <span class="nn">pymarocco</span> <span class="kn">import</span> <span class="n">PyMarocco</span>
<span class="kn">from</span> <span class="nn">pyhalbe.Coordinate</span> <span class="kn">import</span> <span class="n">Wafer</span><span class="p">,</span> <span class="n">HICANNOnWafer</span><span class="p">,</span> <span class="n">Enum</span>

<span class="c"># Number of hardware neurons used for a logical neuron</span>
<span class="n">neuron_size</span> <span class="o">=</span> <span class="mi">4</span>

<span class="c"># Excitatory neuron weight</span>
<span class="n">w_exc</span> <span class="o">=</span> <span class="mf">0.1</span>

<span class="c"># IF_cond_exp parameters</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;v_reset&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">70</span><span class="p">,</span>
    <span class="s">&#39;v_rest&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">50</span><span class="p">,</span>
    <span class="s">&#39;v_thresh&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">45</span><span class="p">,</span>
    <span class="s">&#39;e_rev_I&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">70</span><span class="p">,</span>
    <span class="s">&#39;e_rev_E&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="s">&#39;tau_m&#39;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span>
    <span class="s">&#39;tau_syn_E&#39;</span><span class="p">:</span> <span class="mi">17</span><span class="p">,</span>
    <span class="s">&#39;tau_syn_I&#39;</span><span class="p">:</span> <span class="mi">17</span><span class="p">,</span>
<span class="p">}</span>

<span class="c"># Deactivate logging -- not doing so causes multi-megabyte logfiles which fail</span>
<span class="c"># to be transfered back to the Neuromorphic Compute Platform, causing the job</span>
<span class="c"># to indefenitely hang in the &quot;running&quot; state</span>
<span class="k">for</span> <span class="n">domain</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;Default&quot;</span><span class="p">,</span> <span class="s">&quot;marocco&quot;</span><span class="p">,</span> <span class="s">&quot;sthal.HICANNConfigurator.Time&quot;</span><span class="p">,</span> <span class="s">&quot;hicann-system&quot;</span><span class="p">,</span> <span class="s">&quot;halbe&quot;</span><span class="p">]:</span>
    <span class="n">pylogging</span><span class="o">.</span><span class="n">set_loglevel</span><span class="p">(</span><span class="n">pylogging</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">domain</span><span class="p">),</span> <span class="n">pylogging</span><span class="o">.</span><span class="n">LogLevel</span><span class="o">.</span><span class="n">ERROR</span><span class="p">)</span>

<span class="c"># but we need a little bit of output to know what&#39;s going on</span>
<span class="n">pylogging</span><span class="o">.</span><span class="n">set_loglevel</span><span class="p">(</span><span class="n">pylogging</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;Calibtic&quot;</span><span class="p">),</span> <span class="n">pylogging</span><span class="o">.</span><span class="n">LogLevel</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
<span class="n">pylogging</span><span class="o">.</span><span class="n">set_loglevel</span><span class="p">(</span><span class="n">pylogging</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;marocco&quot;</span><span class="p">),</span> <span class="n">pylogging</span><span class="o">.</span><span class="n">LogLevel</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>

<span class="c"># Setup the router/placement engine</span>
<span class="n">marocco</span> <span class="o">=</span> <span class="n">PyMarocco</span><span class="p">()</span>
<span class="n">marocco</span><span class="o">.</span><span class="n">neuron_placement</span><span class="o">.</span><span class="n">default_neuron_size</span><span class="p">(</span><span class="n">neuron_size</span><span class="p">)</span>

<span class="c"># for backend Hardware</span>
<span class="c"># temporary method to allow locking of synapse drivers by using</span>
<span class="c"># the background generators also for FPGA input routes</span>
<span class="n">marocco</span><span class="o">.</span><span class="n">neuron_placement</span><span class="o">.</span><span class="n">restrict_rightmost_neuron_blocks</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

<span class="n">marocco</span><span class="o">.</span><span class="n">neuron_placement</span><span class="o">.</span><span class="n">minimize_number_of_sending_repeaters</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
<span class="n">marocco</span><span class="o">.</span><span class="n">backend</span> <span class="o">=</span> <span class="n">PyMarocco</span><span class="o">.</span><span class="n">Hardware</span>
<span class="n">marocco</span><span class="o">.</span><span class="n">calib_backend</span> <span class="o">=</span> <span class="n">PyMarocco</span><span class="o">.</span><span class="n">XML</span>
<span class="n">marocco</span><span class="o">.</span><span class="n">calib_path</span> <span class="o">=</span> <span class="s">&quot;/wang/data/calibration/review_2016&quot;</span>
<span class="n">marocco</span><span class="o">.</span><span class="n">persist</span> <span class="o">=</span> <span class="s">&quot;results.bin&quot;</span>
<span class="n">marocco</span><span class="o">.</span><span class="n">hicann_configurator</span> <span class="o">=</span> <span class="n">PyMarocco</span><span class="o">.</span><span class="n">HICANNv4Configurator</span>

<span class="n">marocco</span><span class="o">.</span><span class="n">default_wafer</span> <span class="o">=</span> <span class="n">Wafer</span><span class="p">(</span><span class="mi">33</span><span class="p">)</span>

<span class="c"># choose membrane capacitance</span>
<span class="c"># marocco.param_trafo.use_big_capacitors = False</span>

<span class="n">use</span><span class="o">=</span><span class="n">HICANNOnWafer</span><span class="p">(</span><span class="n">Enum</span><span class="p">(</span><span class="mi">367</span><span class="p">))</span> <span class="c"># choose hicann</span>
<span class="n">marocco</span><span class="o">.</span><span class="n">analog_enum</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">marocco</span><span class="o">.</span><span class="n">hicann_enum</span> <span class="o">=</span> <span class="n">use</span><span class="o">.</span><span class="n">id</span><span class="p">()</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>

<span class="c">#output</span>
<span class="c">#marocco.membrane = &quot;membrane.dat&quot; # voltage trace</span>
<span class="n">marocco</span><span class="o">.</span><span class="n">wafer_cfg</span> <span class="o">=</span> <span class="s">&quot;wafer.bin&quot;</span>   <span class="c"># configuration</span>
<span class="n">marocco</span><span class="o">.</span><span class="n">roqt</span> <span class="o">=</span> <span class="s">&quot;example.roqt&quot;</span>     <span class="c"># visualization</span>

<span class="c">#example for blacklisting, one pyredman.Hicann instance per HICANN</span>
<span class="c">#h = pyredman.Hicann()</span>
<span class="c">#h.drivers().disable(SynapseDriverOnHICANN(C.right, C.Y(4)))</span>
<span class="c">#h.neurons().disable(NeuronOnHICANN(Enum(0)))</span>
<span class="c">#marocco.defects.inject(use, h)</span>

<span class="c"># Setup the NMPM1 PyNN interface &quot;pyhmf&quot;</span>
<span class="n">pynn</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">marocco</span> <span class="o">=</span> <span class="n">marocco</span><span class="p">)</span>

<span class="c"># Create the spike source -- generate a spike all 100ms for 10s</span>
<span class="n">spike_times</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10000</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">in_0</span> <span class="o">=</span> <span class="n">pynn</span><span class="o">.</span><span class="n">Population</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">pynn</span><span class="o">.</span><span class="n">SpikeSourceArray</span><span class="p">,</span> <span class="p">{</span>
    <span class="s">&#39;spike_times&#39;</span><span class="p">:</span> <span class="n">spike_times</span>
<span class="p">})</span>

<span class="c"># Create the target neuron</span>
<span class="n">nn_0</span> <span class="o">=</span> <span class="n">pynn</span><span class="o">.</span><span class="n">Population</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">pynn</span><span class="o">.</span><span class="n">IF_cond_exp</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>

<span class="c"># Introduce the neuron to the placement engine</span>
<span class="n">marocco</span><span class="o">.</span><span class="n">manual_placement</span><span class="o">.</span><span class="n">on_hicann</span><span class="p">(</span><span class="n">nn_0</span><span class="p">,</span> <span class="n">use</span><span class="p">)</span>

<span class="c"># Add a connection between the spike source in_0 and the neuron nn_0 -- the</span>
<span class="c"># connection needs to be added neuron_size times</span>
<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">neuron_size</span><span class="p">):</span>
    <span class="n">pynn</span><span class="o">.</span><span class="n">Projection</span><span class="p">(</span><span class="n">in_0</span><span class="p">,</span> <span class="n">nn_0</span><span class="p">,</span>
        <span class="n">pynn</span><span class="o">.</span><span class="n">FromListConnector</span><span class="p">([(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">w_exc</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)]),</span> <span class="n">target</span> <span class="o">=</span> <span class="s">&#39;excitatory&#39;</span><span class="p">)</span>

<span class="c"># Run the simulation, continue running for 1s after the last spike</span>
<span class="n">pynn</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">spike_times</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1000.0</span><span class="p">)</span>

<span class="c"># End the simulation, gather results</span>
<span class="n">pynn</span><span class="o">.</span><span class="n">end</span><span class="p">()</span>

<span class="c"># Fetch the spike times and print them</span>
<span class="n">spikes</span> <span class="o">=</span> <span class="n">nn_0</span><span class="o">.</span><span class="n">getSpikes</span><span class="p">()</span>
<span class="k">print</span> <span class="s">&quot;&gt;&gt;&gt;&gt;&quot;</span><span class="p">,</span> <span class="n">spikes</span>
<span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="s">&quot;spikes.dat&quot;</span><span class="p">,</span> <span class="n">spikes</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="inspect-the-configuration">
<h3>Inspect the Configuration<a class="headerlink" href="#inspect-the-configuration" title="Permalink to this headline">¶</a></h3>
<div class="highlight-bash"><div class="highlight"><pre>sthal/tools/dump_cfg.py
</pre></div>
</div>
</div>
</div>
<div class="section" id="inspect-the-synapse-loss">
<h2>Inspect the synapse loss<a class="headerlink" href="#inspect-the-synapse-loss" title="Permalink to this headline">¶</a></h2>
<p>When mapping network models to the wafer-scale hardware, it may happen that not
all model synapses can be realized on the hardware due to limited hardware
resources. Below is a simple network that is mapped to very limited resources
so that synapse loss is enforced. For this example we show how to extract
overall mapping statistics and projection-wise or synapse-wise synapse losses.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    create small network with synapse loss.  The synapse loss happens due to a</span>
<span class="sd">    maximum syndriver chain lenght of 5 and only 4 denmems per neuron.  After</span>
<span class="sd">    mapping, the synapse loss per projection is evaluated and plotted for one</span>
<span class="sd">    projection.  The sum of lost synapses per projection is compared to the</span>
<span class="sd">    overall synapse loss returnd by the mapping stats.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">marocco</span> <span class="o">=</span> <span class="n">PyMarocco</span><span class="p">()</span>
    <span class="n">marocco</span><span class="o">.</span><span class="n">placement</span><span class="o">.</span><span class="n">setDefaultNeuronSize</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">marocco</span><span class="o">.</span><span class="n">routing</span><span class="o">.</span><span class="n">syndriver_chain_length</span> <span class="o">=</span> <span class="mi">5</span>

    <span class="n">pynn</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">marocco</span><span class="o">=</span><span class="n">marocco</span><span class="p">)</span>

    <span class="n">neuron</span> <span class="o">=</span> <span class="n">pynn</span><span class="o">.</span><span class="n">Population</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="n">pynn</span><span class="o">.</span><span class="n">IF_cond_exp</span><span class="p">)</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">pynn</span><span class="o">.</span><span class="n">Population</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="n">pynn</span><span class="o">.</span><span class="n">SpikeSourcePoisson</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;rate&#39;</span> <span class="p">:</span> <span class="mi">2</span><span class="p">})</span>

    <span class="n">connector</span> <span class="o">=</span> <span class="n">pynn</span><span class="o">.</span><span class="n">FixedProbabilityConnector</span><span class="p">(</span>
            <span class="n">allow_self_connections</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
            <span class="n">p_connect</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
            <span class="n">weights</span><span class="o">=</span><span class="mf">0.00425</span><span class="p">)</span>
    <span class="n">proj_stim</span> <span class="o">=</span> <span class="n">pynn</span><span class="o">.</span><span class="n">Projection</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">neuron</span><span class="p">,</span> <span class="n">connector</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s">&quot;excitatory&quot;</span><span class="p">)</span>
    <span class="n">proj_rec</span> <span class="o">=</span> <span class="n">pynn</span><span class="o">.</span><span class="n">Projection</span><span class="p">(</span><span class="n">neuron</span><span class="p">,</span> <span class="n">neuron</span><span class="p">,</span> <span class="n">connector</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s">&quot;excitatory&quot;</span><span class="p">)</span>

    <span class="n">pynn</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">print</span> <span class="n">marocco</span><span class="o">.</span><span class="n">stats</span>

    <span class="n">total_syns</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">lost_syns</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">proj</span> <span class="ow">in</span> <span class="p">[</span><span class="n">proj_stim</span><span class="p">,</span> <span class="n">proj_rec</span><span class="p">]:</span>
        <span class="n">l</span><span class="p">,</span><span class="n">t</span> <span class="o">=</span> <span class="n">projectionwise_synapse_loss</span><span class="p">(</span><span class="n">proj</span><span class="p">,</span> <span class="n">marocco</span><span class="p">)</span>
        <span class="n">total_syns</span> <span class="o">+=</span> <span class="n">t</span>
        <span class="n">lost_syns</span> <span class="o">+=</span> <span class="n">l</span>

    <span class="k">assert</span> <span class="n">total_syns</span> <span class="o">==</span> <span class="n">marocco</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">getSynapses</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">lost_syns</span> <span class="o">==</span> <span class="n">marocco</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">getSynapseLoss</span><span class="p">()</span>

    <span class="n">plot_projectionwise_synapse_loss</span><span class="p">(</span><span class="n">proj_stim</span><span class="p">,</span> <span class="n">marocco</span><span class="p">)</span>
    <span class="n">pynn</span><span class="o">.</span><span class="n">end</span><span class="p">()</span>
</pre></div>
</div>
<p>Where <tt class="docutils literal"><span class="pre">print</span> <span class="pre">marocco.stats</span></tt> prints out overall synapse loss statistics:</p>
<div class="highlight-bash"><div class="highlight"><pre>MappingStats <span class="o">{</span>
        synapse_loss: 581 <span class="o">(</span>23.3709%<span class="o">)</span>
        synapses: 2486
        synapses <span class="nb">set</span>: 1905
        synapses lost: 581
        synapses lost<span class="o">(</span>l1<span class="o">)</span>: 0
        populations: 2
        projections: 2
        neurons: 50<span class="o">}</span>
</pre></div>
</div>
<p>Invidual mapping statistics like the number of synapses set can also be
directly accessed in python, see class <tt class="docutils literal"><span class="pre">MappingStats</span></tt> in
<a class="reference external" href="https://brainscales-r.kip.uni-heidelberg.de:8443/view/doc/job/doc-dsl_marocco/marocco_Documentation">documentation-marocco</a>.</p>
<p>The function <tt class="docutils literal"><span class="pre">projectionwise_synapse_loss</span></tt> shows how to calculate the synapse
loss per projection.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">projectionwise_synapse_loss</span><span class="p">(</span><span class="n">proj</span><span class="p">,</span> <span class="n">marocco</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    computes the synapse loss of a projection</span>
<span class="sd">    params:</span>
<span class="sd">      proj    - a pyhmf.Projection</span>
<span class="sd">      marocco -  the PyMarocco object after the mapping has run.</span>

<span class="sd">    returns: (nr of lost synapses, total synapses in projection)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">orig_weights</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="n">getWeights</span><span class="p">(</span><span class="n">format</span><span class="o">=</span><span class="s">&#39;array&#39;</span><span class="p">)</span>
    <span class="n">mapped_weights</span> <span class="o">=</span> <span class="n">marocco</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">getWeights</span><span class="p">(</span><span class="n">proj</span><span class="p">)</span>
    <span class="n">syns</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">orig_weights</span><span class="p">))</span>
    <span class="n">realized_syns</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">mapped_weights</span><span class="p">))</span>
    <span class="n">orig</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">syns</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">realized</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">realized_syns</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">print</span> <span class="s">&quot;Projection-Wise Synapse Loss&quot;</span><span class="p">,</span> <span class="n">proj</span><span class="p">,</span> <span class="p">(</span><span class="n">orig</span> <span class="o">-</span> <span class="n">realized</span><span class="p">)</span><span class="o">*</span><span class="mf">100.</span><span class="o">/</span><span class="n">orig</span>
    <span class="k">return</span> <span class="n">orig</span><span class="o">-</span><span class="n">realized</span><span class="p">,</span> <span class="n">orig</span>
</pre></div>
</div>
<p>Which yields the following oubput for the example above:</p>
<div class="highlight-bash"><div class="highlight"><pre>Projection-Wise Synapse Loss Projection <span class="o">(</span> PyAssembly <span class="o">(</span>50<span class="o">)</span> -&gt; PyAssembly <span class="o">(</span>50<span class="o">))</span> 23.5576923077
Projection-Wise Synapse Loss Projection <span class="o">(</span> PyAssembly <span class="o">(</span>50<span class="o">)</span> -&gt; PyAssembly <span class="o">(</span>50<span class="o">))</span> 23.182552504
</pre></div>
</div>
<p>Finally, the function <tt class="docutils literal"><span class="pre">plot_projectionwise_synapse_loss</span></tt> can be used to plot
the lost and realized synapses of one projection.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">plot_projectionwise_synapse_loss</span><span class="p">(</span><span class="n">proj</span><span class="p">,</span> <span class="n">marocco</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    plots the realized and lost synapses of a projection</span>
<span class="sd">    params:</span>
<span class="sd">      proj    - a pyhmf.Projection</span>
<span class="sd">      marocco -  the PyMarocco object after the mapping has run.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">orig_weights</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="n">getWeights</span><span class="p">(</span><span class="n">format</span><span class="o">=</span><span class="s">&#39;array&#39;</span><span class="p">)</span>
    <span class="n">mapped_weights</span> <span class="o">=</span> <span class="n">marocco</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">getWeights</span><span class="p">(</span><span class="n">proj</span><span class="p">)</span>
    <span class="n">realized_syns</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">mapped_weights</span><span class="p">))</span>
    <span class="n">lost_syns</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">orig_weights</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">mapped_weights</span><span class="p">))</span>

    <span class="n">conn_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">orig_weights</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">conn_matrix</span> <span class="p">[</span> <span class="n">realized_syns</span> <span class="p">]</span> <span class="o">=</span>  <span class="mf">1.</span>
    <span class="n">conn_matrix</span> <span class="p">[</span> <span class="n">lost_syns</span> <span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span>

    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">conn_matrix</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s">&#39;hot&#39;</span><span class="p">,</span><span class="n">interpolation</span><span class="o">=</span><span class="s">&#39;nearest&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&quot;post neuron&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&quot;pre neuron&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&quot;realized and lost synapses&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="figure">
<img alt="Realized and Lost Synapses of a Projection" src="../_images/synapse_loss.png" />
<p class="caption">Realized (black) and lost (red) synapses of the stimulus projection in the
example network above.</p>
</div>
</div>
</div>

            </div>

            <aside class="hbpdoc-hnav hbpdoc-hnav-bottom">
                
                <span class="hbpdoc-hnav-previous">
                    previous: <a class="hbpdoc-hnav-link" href="pm_hardware_configuration.html">Hardware configuration</a>
                </span>
                
                
                <span class="hbpdoc-hnav-next">
                    next: <a class="hbpdoc-hnav-link" href="ess.html">Executable System Specification (ESS)</a>
                </span>
                
            </aside>
        </article>
    </section>


    <div class="hbpdoc-footer">
        HBP Neuromorphic Computing Platform Guidebook <small>0.1</small> 
    <div class="footer">
        &copy; Copyright 2015, Andrew P. Davison, Eric Müller, Sebastian Schmitt, Bernhard Vogginger, David Lester, Thomas Pfeil, ....
      Last updated on Aug 17, 2016 (fda7c57, preliminary documentation).
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
    </div>
</div>

  </body>
</html>